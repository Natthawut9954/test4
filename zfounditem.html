<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    
</head>
<body>

    <div id="login-modal-wrapper" class="hidden">
        <div id="login-page">
            <h1>üè´ Lost & Found</h1>
            <p style="color: var(--text-secondary); margin-top: -20px; margin-bottom: 25px;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
            <form id="login-form">
                <div class="form-group">
                    <label for="username">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-group">
                    <label for="password">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="btn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                <p id="login-error" class="hidden">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
                <button type="button" class="btn" id="cancel-login-btn" style="background-color: var(--text-secondary); margin-top: 10px;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </form>
        </div>
    </div>

    <div id="main-app">
        <header>
            <h1 id="header-title">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢</h1>
            <button id="login-trigger-btn" title="‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö" style="background: none; border: none; cursor: pointer; font-size: 24px; color: var(--primary-color);">üîë</button>
            <button id="logout-btn" title="‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö" class="hidden">‚Ü™Ô∏è</button>
        </header>
        <main>
            <section id="add-item-view" class="view">
                 <div id="add-item-form-container">
                    <form id="add-item-form">
                        <div class="form-group">
                            <label for="item-name">‡∏™‡∏¥‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏ö</label>
                            <input type="text" id="item-name" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå, ‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡πÄ‡∏á‡∏¥‡∏ô" required>
                        </div>
                        <div class="form-group">
                            <label for="item-description">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                            <textarea id="item-description" class="form-group input" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏µ‡∏î‡∏≥, ‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠ Samsung" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="item-location">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏û‡∏ö</label>
                            <input type="text" id="item-location" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏£‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£, ‡πÉ‡∏ï‡πâ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ 3" required>
                        </div>
                        <div class="form-group">
                            <label for="item-finder">‡∏ú‡∏π‡πâ‡∏û‡∏ö‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢</label>
                            <input type="text" id="item-finder" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ" required>
                        </div>
                        <button type="submit" class="btn btn-submit-item">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                    </form>
                    <a href="public_view.html" class="btn" style="margin-top: 20px; text-align: center; display: block; background-color: blue;">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</a>
                    <a href="index.html" class="btn" style="margin-top: 20px; text-align: center; display: block; background-color: rgb(0, 255, 68);">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
                 </div>
            </section>
            
            <section id="home-view" class="view hidden">
                <div id="home-items-grid" class="items-grid"></div>
            </section>
            <section id="unclaimed-view" class="view hidden">
                <div id="unclaimed-items-grid" class="items-grid"></div>
            </section>
            <section id="claimed-view" class="view hidden">
                <div id="claimed-items-grid" class="items-grid"></div>
            </section>
            <section id="reported-view" class="view hidden">
                <div id="reported-items-grid" class="items-grid"></div>
            </section>

            <section id="profile-view" class="view hidden">
                <div id="profile-content">
                    <h2>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h2>
                    <div class="profile-info-group">
                        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:</label>
                        <p id="profile-username">admin</p>
                    </div>
                    <div class="profile-info-group">
                        <label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</label>
                        <p id="profile-role">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</p>
                    </div>
                    <div class="profile-info-group">
                        <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</label>
                        <p id="profile-status">‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</p>
                    </div>
                </div>
            </section>
        </main>

        <nav id="bottom-nav" class="hidden">
            <button class="nav-btn" data-view="home-view" data-title="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏ö‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢">
                <span class="icon">üè†</span>
                <span class="label">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
            </button>
            <button class="nav-btn" data-view="unclaimed-view" data-title="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö">
                <span class="icon">üì¶</span>
                <span class="label">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö</span>
            </button>
            <button class="nav-btn" data-view="claimed-view" data-title="‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß">
                <span class="icon">‚úÖ</span>
                <span class="label">‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß</span>
            </button>
            <button class="nav-btn" data-view="reported-view" data-title="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢">
                <span class="icon">‚ö†Ô∏è</span>
                <span class="label">‡πÅ‡∏à‡πâ‡∏á‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢</span>
            </button>
           <button class="nav-btn" id="profile-btn" data-view="profile-view" data-title="‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå">
                 <span class="icon"></span>
                 <span class="label"></span>
            </button>
        </nav>
        
        <button id="add-item-fab" data-view="add-item-view" data-title="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢" class="hidden">+</button>
        
    </div>
    
    <div id="modal-overlay" class="modal-overlay hidden"></div>
    <div id="item-modal" class="modal">
        <span class="modal-close">&times;</span>
        <div id="modal-content" class="modal-content"></div>
    </div>

    <script>
        // ================ GOOGLE APPS SCRIPT URL =========================
        // !!! PASTE YOUR WEB APP URL HERE !!!
        const googleAppsScriptUrl = "https://script.google.com/macros/s/AKfycbz8qstKqazIpyyf87y7DgsiCMBlBgs_eNayeF984TylCkBK7nTOl5Uv9YZZXG45ZSWp/exec"; 
        // =================================================================

        // --- DOM Elements ---
        const loginModalWrapper = document.getElementById('login-modal-wrapper');
        const mainApp = document.getElementById('main-app');
        const loginForm = document.getElementById('login-form');
        const loginError = document.getElementById('login-error');
        const loginTriggerBtn = document.getElementById('login-trigger-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const cancelLoginBtn = document.getElementById('cancel-login-btn');
        const headerTitle = document.getElementById('header-title');
        
        const bottomNav = document.getElementById('bottom-nav');
        const navButtons = bottomNav.querySelectorAll('.nav-btn');
        const fab = document.getElementById('add-item-fab');

        const views = document.querySelectorAll('.view');
        const addItemForm = document.getElementById('add-item-form');
        
        const homeGrid = document.getElementById('home-items-grid');
        const unclaimedGrid = document.getElementById('unclaimed-items-grid');
        const claimedGrid = document.getElementById('claimed-items-grid');
        const reportedGrid = document.getElementById('reported-items-grid');

        const modalOverlay = document.getElementById('modal-overlay');
        const itemModal = document.getElementById('item-modal');
        const modalClose = document.querySelector('.modal-close');
        const modalContent = document.getElementById('modal-content');

        // --- State Variable ---
        let isLoggedIn = false;
        let allLostItems = [];

        // --- Initial View Setup (Public Add Item Form) ---
        showView('add-item-view', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢');
        updateUIForAuthState();

        // --- Event Listeners for Login/Logout ---
        loginTriggerBtn.addEventListener('click', () => {
            loginModalWrapper.classList.remove('hidden');
            modalOverlay.classList.remove('hidden');
            mainApp.classList.add('hidden');
        });

        cancelLoginBtn.addEventListener('click', () => {
            loginModalWrapper.classList.add('hidden');
            modalOverlay.classList.add('hidden');
            loginForm.reset();
            loginError.classList.add('hidden');
            mainApp.classList.remove('hidden');
        });

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = loginForm.username.value;
            const password = loginForm.password.value;

            if (username === 'admin' && password === 'admin5555') {
                isLoggedIn = true;
                loginModalWrapper.classList.add('hidden');
                modalOverlay.classList.add('hidden');
                loginError.classList.add('hidden');
                mainApp.classList.remove('hidden');
                updateUIForAuthState();
                fetchAndDisplayItems();
                fetchAndDisplayReportedItems();
                showView('home-view', '‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î');
                document.querySelector('.nav-btn[data-view="home-view"]').classList.add('active');
            } else {
                loginError.classList.remove('hidden');
            }
        });

        logoutBtn.addEventListener('click', () => {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                isLoggedIn = false;
                updateUIForAuthState();
                showView('add-item-view', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢');
                loginForm.reset();
            }
        });

        function updateUIForAuthState() {
            if (isLoggedIn) {
                loginTriggerBtn.classList.add('hidden');
                logoutBtn.classList.remove('hidden');
                bottomNav.classList.remove('hidden');
                fab.classList.remove('hidden');
            } else {
                loginTriggerBtn.classList.remove('hidden');
                logoutBtn.classList.add('hidden');
                bottomNav.classList.add('hidden');
                fab.classList.add('hidden');
                navButtons.forEach(btn => btn.classList.remove('active'));
            }
        }

        // --- NAVIGATION LOGIC ---
        function showView(viewId, title) {
            headerTitle.textContent = title;
            views.forEach(view => view.classList.add('hidden'));
            document.getElementById(viewId).classList.remove('hidden');
        }

        navButtons.forEach(button => {
            button.addEventListener('click', () => {
                navButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                const viewId = button.dataset.view;
                const title = button.dataset.title;
                showView(viewId, title);
            });
        });

        fab.addEventListener('click', () => {
            navButtons.forEach(btn => btn.classList.remove('active'));
            showView(fab.dataset.view, fab.dataset.title);
        });

        // --- ADD ITEM LOGIC ---
        addItemForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = {
                id: Date.now().toString(),
                name: addItemForm['item-name'].value,
                description: addItemForm['item-description'].value,
                location: addItemForm['item-location'].value,
                finder: addItemForm['item-finder'].value,
                status: 'unclaimed',
                foundTimestamp: new Date().toLocaleString()
            };
            
            sendDataToSheet('lostItems', 'add', formData);
            addItemForm.reset();
        });

        // --- GOOGLE APPS SCRIPT COMMUNICATION FUNCTIONS ---
        async function fetchAndDisplayItems() {
            try {
                const response = await fetch(`${googleAppsScriptUrl}?sheet=lostItems`);
                const items = await response.json();
                allLostItems = items.sort((a, b) => b.foundTimestamp - a.foundTimestamp);
                
                homeGrid.innerHTML = '';
                unclaimedGrid.innerHTML = '';
                claimedGrid.innerHTML = '';
                
                if (allLostItems.length === 0) {
                    const placeholder = '<p style="text-align: center; color: var(--text-secondary); margin-top: 30px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>';
                    homeGrid.innerHTML = placeholder;
                    unclaimedGrid.innerHTML = placeholder;
                    claimedGrid.innerHTML = placeholder;
                }
                
                allLostItems.forEach(item => {
                    const cardHTML = createItemCard(item, item.id);
                    homeGrid.innerHTML += cardHTML;
                    if (item.status === 'unclaimed') {
                        unclaimedGrid.innerHTML += cardHTML;
                    } else {
                        claimedGrid.innerHTML += cardHTML;
                    }
                });
                
                addCardEventListeners();
                
            } catch (error) {
                console.error("Error fetching items: ", error);
                showInfoModal('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏ö‡πÑ‡∏î‡πâ: ' + error.message, 'error');
            }
        }
        
        async function fetchAndDisplayReportedItems() {
            try {
                const response = await fetch(`${googleAppsScriptUrl}?sheet=lostReports`);
                const reports = await response.json();
                
                reportedGrid.innerHTML = '';
                
                if (reports.length === 0) {
                    const placeholder = '<p style="text-align: center; color: var(--text-secondary); margin-top: 30px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢</p>';
                    reportedGrid.innerHTML = placeholder;
                }
                
                reports.sort((a, b) => b.reportTimestamp - a.reportTimestamp).forEach(report => {
                    const cardHTML = createReportCard(report, report.id);
                    reportedGrid.innerHTML += cardHTML;
                });
                
                addCardEventListeners();

            } catch (error) {
                console.error("Error fetching reports: ", error);
                showInfoModal('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢‡πÑ‡∏î‡πâ: ' + error.message, 'error');
            }
        }

        function addCardEventListeners() {
            document.querySelectorAll('.item-card').forEach(card => {
                card.addEventListener('click', () => {
                    if (isLoggedIn) {
                        const id = card.getAttribute('data-id');
                        if (card.classList.contains('report-card')) {
                            showReportDetails(id);
                        } else {
                            showItemDetails(id);
                        }
                    } else {
                        showInfoModal('‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï', '‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡πà‡∏á‡∏Ç‡∏≠‡∏á.', 'error');
                    }
                });
            });
        }
        
        async function sendDataToSheet(sheetName, action, data) {
            try {
                const response = await fetch(`${googleAppsScriptUrl}?sheet=${sheetName}&action=${action}`, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                if (result.success) {
                    showInfoModal('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', result.message, 'success');
                    if (isLoggedIn) {
                        fetchAndDisplayItems();
                        fetchAndDisplayReportedItems();
                    }
                } else {
                    showInfoModal('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!', result.message, 'error');
                }
            } catch (error) {
                console.error("Error sending data to sheet: ", error);
                showInfoModal('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ' + error.message, 'error');
            }
        }
        
        function getItemIcon(itemName) {
            const name = itemName.toLowerCase();
            if (name.includes('‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠') || name.includes('phone')) return 'üì±';
            if (name.includes('‡πÄ‡∏á‡∏¥‡∏ô') || name.includes('‡∏ö‡∏≤‡∏ó') || name.includes('money')) return 'üí∞';
            if (name.includes('‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤')) return 'üëú';
            if (name.includes('‡∏Å‡∏∏‡∏ç‡πÅ‡∏à')) return 'üîë';
            if (name.includes('‡∏´‡∏π‡∏ü‡∏±‡∏á')) return 'üéß';
            if (name.includes('‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠')) return 'üìö';
            if (name.includes('‡∏ö‡∏±‡∏ï‡∏£')) return 'üí≥';
            return '‚ùì';
        }

        function createItemCard(item, id) {
            const icon = getItemIcon(item.name);
            return `
                <div class="item-card" data-id="${id}">
                    <div class="icon">${icon}</div>
                    <div class="info">
                        <h3>${item.name}</h3>
                        <p>${item.location || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà'}</p>
                    </div>
                </div>
            `;
        }
        
        function createReportCard(report, id) {
            const icon = getItemIcon(report.name);
            return `
                <div class="item-card report-card" data-id="${id}">
                    <div class="icon">${icon}</div>
                    <div class="info">
                        <h3>${report.name}</h3>
                        <p>${report.location || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà'}</p>
                    </div>
                </div>
            `;
        }

        function showItemDetails(itemId) {
            const item = allLostItems.find(i => i.id == itemId);
            if (!item) {
                showInfoModal('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£.', 'error');
                return;
            }
            const modalHTML = `
                <h3><span class="icon">${getItemIcon(item.name)}</span> ${item.name}</h3>
                <p><strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong> ${item.description}</p>
                <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏ö:</strong> ${item.location}</p>
                <p><strong>‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏û‡∏ö:</strong> ${item.finder}</p>
                <p><strong>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö:</strong> ${item.foundTimestamp}</p>
                <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> ${item.status === 'unclaimed' ? '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö' : '‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß'}</p>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="editItem('${itemId}')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                    <button class="btn btn-danger" onclick="deleteItem('${itemId}')">‡∏•‡∏ö</button>
                    ${item.status === 'unclaimed' ? `<button class="btn btn-primary" onclick="markAsClaimed('${itemId}')">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô</button>` : ''}
                </div>
            `;
            modalContent.innerHTML = modalHTML;
            modalOverlay.classList.remove('hidden');
            itemModal.classList.add('visible');
        }
        
        async function showReportDetails(reportId) {
             try {
                const response = await fetch(`${googleAppsScriptUrl}?sheet=lostReports`);
                const reports = await response.json();
                const report = reports.find(r => r.id == reportId);
                 if (!report) {
                    showInfoModal('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£.', 'error');
                    return;
                }
                const modalHTML = `
                    <h3><span class="icon">${getItemIcon(report.name)}</span> ${report.name}</h3>
                    <p><strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong> ${report.description}</p>
                    <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏¢:</strong> ${report.location}</p>
                    <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á:</strong> ${report.reporter}</p>
                    <p><strong>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå:</strong> ${report.phone}</p>
                    <p><strong>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á:</strong> ${report.reportTimestamp}</p>
                    <div class="modal-actions">
                        <button class="btn btn-danger" onclick="deleteReport('${reportId}')">‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
                    </div>
                `;
                modalContent.innerHTML = modalHTML;
                modalOverlay.classList.remove('hidden');
                itemModal.classList.add('visible');
            } catch (error) {
                console.error("Error fetching report details: ", error);
                showInfoModal('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ' + error.message, 'error');
            }
        }
        
        function showConfirmModal(title, message, onConfirmCallback) {
            modalContent.innerHTML = `
                <h3 style="color: var(--text-color); text-align: center; margin-bottom: 20px;">${title}</h3>
                <p style="text-align: center; margin-bottom: 30px;">${message}</p>
                <div class="modal-actions" style="text-align: center; display: flex; justify-content: center; gap: 15px;">
                    <button class="btn btn-secondary" id="confirm-cancel-btn">‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà</button>
                    <button class="btn btn-primary" id="confirm-ok-btn">‡πÉ‡∏ä‡πà</button>
                </div>
            `;
            modalOverlay.classList.remove('hidden');
            itemModal.classList.add('visible');

            document.getElementById('confirm-ok-btn').onclick = () => {
                closeModal();
                onConfirmCallback();
            };

            document.getElementById('confirm-cancel-btn').onclick = () => {
                closeModal();
            };
        }
        
        function markAsClaimed(itemId) {
            showConfirmModal(
                '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô',
                '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏ä‡∏¥‡πâ‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
                () => {
                    const itemToUpdate = allLostItems.find(i => i.id == itemId);
                    itemToUpdate.status = 'claimed';
                    sendDataToSheet('lostItems', 'update', itemToUpdate);
                }
            );
        }
        
        function closeModal() {
            itemModal.classList.remove('visible');
            modalOverlay.classList.add('hidden');
        }

        modalOverlay.addEventListener('click', closeModal);
        modalClose.addEventListener('click', closeModal);

        function showInfoModal(title, message, type = 'info') {
            let icon = '';
            let titleColor = '';

            if (type === 'success') {
                icon = '‚úÖ';
                titleColor = 'var(--primary-color)';
            } else if (type === 'error') {
                icon = '‚ùå';
                titleColor = 'var(--error-color)';
            } else {
                icon = '‚ÑπÔ∏è';
                titleColor = 'var(--text-color)';
            }

            modalContent.innerHTML = `
                <h3 style="color: ${titleColor}; text-align: center; display: block;">${icon} ${title}</h3>
                <p style="text-align: center; margin-bottom: 25px;">${message}</p>
                <div class="modal-actions" style="text-align: center;">
                    <button class="btn btn-primary" onclick="closeModal()">‡∏ï‡∏Å‡∏•‡∏á</button>
                </div>
            `;
            modalOverlay.classList.remove('hidden');
            itemModal.classList.add('visible');
        }

        function editItem(itemId) {
            alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç');
        }

        function deleteItem(itemId) {
            showConfirmModal(
                '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö',
                '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ',
                () => {
                    sendDataToSheet('lostItems', 'delete', { id: itemId });
                }
            );
        }
        
        function deleteReport(reportId) {
            showConfirmModal(
                '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö',
                '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
                () => {
                    sendDataToSheet('lostReports', 'delete', { id: reportId });
                }
            );
        }

    </script>
    
</body>
</html>