<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
</head>
<body>

    <div id="login-wrapper">
        <div id="login-page">
            <h1>üè´ Lost & Found</h1>
            <p style="color: var(--text-secondary); margin-top: -20px; margin-bottom: 25px;">‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢</p>
            <form id="login-form">
                <div class="form-group">
                    <label for="username">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-group">
                    <label for="password">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="btn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                <p id="login-error" class="hidden">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
            </form>
        </div>
    </div>

    <div id="main-app" class="hidden">
        <header>
            <h1 id="header-title">‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h1>
            <button id="logout-btn" title="‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö">‚Ü™Ô∏è</button>
        </header>
        <main>
            <section id="home-view" class="view">
                <div id="home-items-grid" class="items-grid"></div>
            </section>
            <section id="add-item-view" class="view hidden">
                 <div id="add-item-form-container">
                    <form id="add-item-form">
                        <div class="form-group">
                            <label for="item-name">‡∏™‡∏¥‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏ö</label>
                            <input type="text" id="item-name" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå, ‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡πÄ‡∏á‡∏¥‡∏ô" required>
                        </div>
                        <div class="form-group">
                            <label for="item-description">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                            <textarea id="item-description" class="form-group input" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏µ‡∏î‡∏≥, ‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠ Samsung" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="item-location">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏û‡∏ö</label>
                            <input type="text" id="item-location" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏£‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£, ‡πÉ‡∏ï‡πâ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ 3" required>
                        </div>
                        <div class="form-group">
                            <label for="item-finder">‡∏ú‡∏π‡πâ‡∏û‡∏ö‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢</label>
                            <input type="text" id="item-finder" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ" required>
                        </div>
                        <button type="submit" class="btn btn-submit-item">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                    </form>
                </div>
            </section>
            <section id="unclaimed-view" class="view hidden">
                <div id="unclaimed-items-grid" class="items-grid"></div>
            </section>
            <section id="claimed-view" class="view hidden">
                <div id="claimed-items-grid" class="items-grid"></div>
            </section>

            <section id="profile-view" class="view hidden">
                <div id="profile-content">
                    <h2>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h2>
                    <div class="profile-info-group">
                        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:</label>
                        <p id="profile-username">admin</p>
                    </div>
                    <div class="profile-info-group">
                        <label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</label>
                        <p id="profile-role">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</p>
                    </div>
                    <div class="profile-info-group">
                        <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</label>
                        <p id="profile-status">‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</p>
                    </div>
                    
                </div>
            </section>
        </main>

        <nav id="bottom-nav">
            <button class="nav-btn active" data-view="home-view" data-title="‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î">
                <span class="icon">üè†</span>
                <span class="label">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
            </button>
            <button class="nav-btn" data-view="unclaimed-view" data-title="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö">
                <span class="icon">üì¶</span>
                <span class="label">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö</span>
            </button>
            <button class="nav-btn" data-view="claimed-view" data-title="‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß">
                <span class="icon">‚úÖ</span>
                <span class="label">‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß</span>
            </button>
           <button class="nav-btn" id="profile-btn" data-view="profile-view" data-title="‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå">
                 <span class="icon">üë§</span>
                 <span class="label">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</span>
            </button>
        </nav>
        
        <button id="add-item-fab" data-view="add-item-view" data-title="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢">+</button>

    </div>
    
    <div id="modal-overlay" class="modal-overlay hidden"></div>
    <div id="item-modal" class="modal">
        <span class="modal-close">&times;</span>
        <div id="modal-content" class="modal-content"></div>
    </div>

    <script>
        // ‡πÇ‡∏Ñ‡πâ‡∏î JavaScript ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°
        // ‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ
        // =================================================================
        // ================ FIREBASE CONFIGURATION =========================
         const firebaseConfig = {
  apiKey: "AIzaSyDaDQdwfZb_wtlDV5_0gPCjYBzXn6Gr2jw",
  authDomain: "testing-e4682.firebaseapp.com",
  projectId: "testing-e4682",
  storageBucket: "testing-e4682.firebasestorage.app",
  messagingSenderId: "729054599488",
  appId: "1:729054599488:web:d73367a024087a00f382a5",
  measurementId: "G-S6CLQK5MG3"
};
        // =================================================================

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const lostItemsCollection = db.collection("lostItems");

        // --- DOM Elements ---
        const loginWrapper = document.getElementById('login-wrapper');
        const mainApp = document.getElementById('main-app');
        const loginForm = document.getElementById('login-form');
        const loginError = document.getElementById('login-error');
        const logoutBtn = document.getElementById('logout-btn');
        const headerTitle = document.getElementById('header-title');
        
        const bottomNav = document.getElementById('bottom-nav');
        const navButtons = bottomNav.querySelectorAll('.nav-btn');
        const fab = document.getElementById('add-item-fab');

        const views = document.querySelectorAll('.view');
        const addItemForm = document.getElementById('add-item-form');
        
        const homeGrid = document.getElementById('home-items-grid');
        const unclaimedGrid = document.getElementById('unclaimed-items-grid');
        const claimedGrid = document.getElementById('claimed-items-grid');

        const modalOverlay = document.getElementById('modal-overlay');
        const itemModal = document.getElementById('item-modal');
        const modalClose = document.querySelector('.modal-close');
        const modalContent = document.getElementById('modal-content');

        // --- LOGIN & LOGOUT ---
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = loginForm.username.value;
            const password = loginForm.password.value;

            if (username === 'admin' && password === 'admin5555') {
                loginWrapper.classList.add('hidden');
                mainApp.classList.remove('hidden');
                loginError.classList.add('hidden');
                fetchAndDisplayItems();
            } else {
                loginError.classList.remove('hidden');
            }
        });

        logoutBtn.addEventListener('click', () => {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                mainApp.classList.add('hidden');
                loginWrapper.classList.remove('hidden');
                loginForm.reset();
            }
        });

        // --- NAVIGATION LOGIC ---
        function switchView(button) {
            navButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            
            const viewId = button.dataset.view;
            const title = button.dataset.title;

            headerTitle.textContent = title;
            views.forEach(view => view.classList.add('hidden'));
            document.getElementById(viewId).classList.remove('hidden');
        }

        navButtons.forEach(button => {
            button.addEventListener('click', () => switchView(button));
        });

        fab.addEventListener('click', () => {
            navButtons.forEach(btn => btn.classList.remove('active'));
            const viewId = fab.dataset.view;
            const title = fab.dataset.title;
            headerTitle.textContent = title;
            views.forEach(view => view.classList.add('hidden'));
            document.getElementById(viewId).classList.remove('hidden');
        });


        // --- ADD ITEM LOGIC ---
        addItemForm.addEventListener('submit', (e) => {
            e.preventDefault();
            lostItemsCollection.add({
                name: addItemForm['item-name'].value,
                description: addItemForm['item-description'].value,
                location: addItemForm['item-location'].value,
                finder: addItemForm['item-finder'].value,
                status: 'unclaimed',
                foundTimestamp: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                addItemForm.reset();
                document.querySelector('.nav-btn[data-view="home-view"]').click();
            })
            .catch((error) => {
                console.error("Error adding document: ", error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
            });
        });

        // --- FETCH AND DISPLAY ITEMS ---
        function fetchAndDisplayItems() {
            lostItemsCollection.orderBy('foundTimestamp', 'desc').onSnapshot(querySnapshot => {
                homeGrid.innerHTML = '';
                unclaimedGrid.innerHTML = '';
                claimedGrid.innerHTML = '';

                if (querySnapshot.empty) {
                    const placeholder = '<p style="text-align: center; color: var(--text-secondary); margin-top: 30px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>';
                    homeGrid.innerHTML = placeholder;
                    unclaimedGrid.innerHTML = placeholder;
                    claimedGrid.innerHTML = placeholder;
                }
                
                querySnapshot.forEach(doc => {
                    const item = doc.data();
                    const itemId = doc.id;
                    const cardHTML = createItemCard(item, itemId);
                    homeGrid.innerHTML += cardHTML;
                    if (item.status === 'unclaimed') {
                        unclaimedGrid.innerHTML += cardHTML;
                    } else {
                        claimedGrid.innerHTML += cardHTML;
                    }
                });

                document.querySelectorAll('.item-card').forEach(card => {
                    card.addEventListener('click', () => {
                         const id = card.getAttribute('data-id');
                         showItemDetails(id);
                    });
                });
            });
        }
        
        function getItemIcon(itemName) {
            const name = itemName.toLowerCase();
            if (name.includes('‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå') || name.includes('phone')) return 'üì±';
            if (name.includes('‡πÄ‡∏á‡∏¥‡∏ô') || name.includes('‡∏ö‡∏≤‡∏ó') || name.includes('money')) return 'üí∞';
            if (name.includes('‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤')) return 'üëú';
            if (name.includes('‡∏Å‡∏∏‡∏ç‡πÅ‡∏à')) return 'üîë';
            if (name.includes('‡∏´‡∏π‡∏ü‡∏±‡∏á')) return 'üéß';
            if (name.includes('‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠')) return 'üìö';
            if (name.includes('‡∏ö‡∏±‡∏ï‡∏£')) return 'üí≥';
            return '‚ùì';
        }

        function createItemCard(item, id) {
            const icon = getItemIcon(item.name);
            return `
                <div class="item-card" data-id="${id}">
                    <div class="icon">${icon}</div>
                    <div class="info">
                        <h3>${item.name}</h3>
                        <p>${item.location || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà'}</p>
                    </div>
                </div>
            `;
        }

        // --- MODAL LOGIC ---
        function showItemDetails(itemId) {
            lostItemsCollection.doc(itemId).get().then(doc => {
                if (doc.exists) {
                    const item = doc.data();
                    const foundTime = item.foundTimestamp ? new Date(item.foundTimestamp.seconds * 1000).toLocaleString('th-TH') : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                    
                    let modalHTML = `
                        <h3><span class="icon">${getItemIcon(item.name)}</span> ${item.name}</h3>
                        <p><strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong> ${item.description}</p>
                        <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏ö:</strong> ${item.location}</p>
                        <p><strong>‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏û‡∏ö:</strong> ${item.finder}</p>
                        <p><strong>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö:</strong> ${foundTime}</p>
                        <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> ${item.status === 'unclaimed' ? '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö' : '‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß'}</p>
                    `;
                    
                    if (item.status === 'unclaimed') {
                         modalHTML += `
                         <div class="modal-actions">
                            <button class="btn-claim" onclick="markAsClaimed('${itemId}')">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô</button>
                         </div>
                         `;
                    }
                    
                    modalContent.innerHTML = modalHTML;
                    modalOverlay.classList.remove('hidden');
                    itemModal.classList.add('visible');
                }
            });
        }
        
        function markAsClaimed(itemId) {
            if(confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏ä‡∏¥‡πâ‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                lostItemsCollection.doc(itemId).update({ status: 'claimed' })
                .then(() => {
                    alert('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
                    closeModal();
                })
                .catch(error => console.error("Error updating document: ", error));
            }
        }

        function closeModal() {
            itemModal.classList.remove('visible');
            modalOverlay.classList.add('hidden');
        }

        modalOverlay.addEventListener('click', closeModal);
        modalClose.addEventListener('click', closeModal);

        fab.addEventListener('click', () => {
            navButtons.forEach(btn => btn.classList.remove('active'));
            const viewId = fab.dataset.view;
            const title = fab.dataset.title;
            headerTitle.textContent = title;
            views.forEach(view => view.classList.add('hidden'));
            document.getElementById(viewId).classList.remove('hidden');
        });
    </script>
</body>
</html>